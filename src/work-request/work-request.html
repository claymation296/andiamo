<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../shared-styles.html">
<link rel="import" href="../../elements/contacts-selection-list.html" />
<link rel="import" href="../../elements/basic-list.html" />
<link rel="import" href="../../elements/dropdown-list-array.html" />
<link rel="import" href="../../behaviors/on-tap-behavior.html"/>
<link rel="import" href="../overlays/out-date-overlay/start-date.html">
<dom-module id="work-request">
  <template>
    <style include="shared-styles">
      :host {
        display: block;

        padding: 10px;
        background-color: var(--light-primary-color);
      }

      
    </style>

    <paper-dropdown-menu label="Type of Work:">
      <paper-listbox class="dropdown-content" selected="{{selectedWork}}" attr-for-selected="value" >
        <paper-item value="Electrical">Electrical</paper-item>
        <paper-item value="Framing">Framing</paper-item>
        <paper-item value="Landscape">Landscape</paper-item>
        <paper-item value="Roofing">Roofing</paper-item>
      </paper-listbox>
    </paper-dropdown-menu>
 
    <dropdown-list-array  contacts="../data/locations.json"></dropdown-list-array>
    <start-date id="pickStartDate"></start-date>
        <paper-button id="dateButton" on-tap="_chooseDateButtonTapped">[[_chooseDate(datePicked)]]</paper-button>
    <paper-button raised id="contactsButton" on-tap="_contactsButtonTapped">Choose Contacts</paper-button>

  </template>

  <script>
    Polymer({
      is: 'work-request',

        properties: {
          selectedWork: {
          type: String,
          observer: '_selectedWorkChanged',
          },

          datePicked: {
            type: String,
            value: 'Choose Date',
          }
        },

        behaviors: [window.BCDEV.Behaviors.OnTapBehavior],

        listeners: {
          'dropdown-list-array-selected-item': '_selectedItem',
          'start-date-fab-tapped': '_selectedDate'
        },
      

        _contactsButtonTapped() {
          const open = () => {
            const callback = () => {
              window.BCDEV.contactsOverlay.init();
              this.fire('contacts-button-tapped', {selectedWork: this.selectedWork,selectedItem: this.selectedItem, selectedDate: this.selectedDate }); 
            };
              window.BCDEV.contactsOverlay.open(callback);
          };
          this.onTap = open;
        },


        _chooseDate(datePicked) {
          if(datePicked) {
            return datePicked;
          } 
        },


        _chooseDateButtonTapped() {
          const open = () => {
          	this.$.pickStartDate.init();
          };
          this.onTap = open;
        },

        _selectedDate(event){
        	this.selectedDate = event.detail.start;
        	this.$.pickStartDate.resetAll();
          this.datePicked = event.detail.start.date.toLocaleDateString() + ' ' + event.detail.start.time;
          date => date.toLocaleDateString();
        },

        _selectedWorkChanged: function(selected){
          if (!selected) {return;} 
        },


        _selectedItem (event){
          this.selectedItem = event.detail.selected;
        },

    });

  </script>
</dom-module>
